/*! For license information please see a0c49a06f76db21088f1.js.LICENSE.txt */
function _regenerator(){var e,r,n="function"==typeof Symbol?Symbol:{},t=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function o(n,t,a,o){var u=t&&t.prototype instanceof c?t:c,l=Object.create(u.prototype);return _regeneratorDefine2(l,"_invoke",function(n,t,a){var o,c,u,l=0,f=a||[],s=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(r,n){return o=r,c=0,u=e,d.n=n,i}};function p(n,t){for(c=n,u=t,r=0;!s&&l&&!a&&r<f.length;r++){var a,o=f[r],p=d.p,y=o[2];n>3?(a=y===t)&&(u=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=e):o[0]<=p&&((a=n<2&&p<o[1])?(c=0,d.v=t,d.n=o[1]):p<y&&(a=n<3||o[0]>t||t>y)&&(o[4]=n,o[5]=t,d.n=y,c=0))}if(a||n>1)return i;throw s=!0,t}return function(a,f,y){if(l>1)throw TypeError("Generator is already running");for(s&&1===f&&p(f,y),c=f,u=y;(r=c<2?e:u)||!s;){o||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(l=2,o){if(c||(a="next"),r=o[a]){if(!(r=r.call(o,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,c<2&&(c=0)}else 1===c&&(r=o.return)&&r.call(o),c<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),c=1);o=e}else if((r=(s=d.n<0)?u:n.call(t,d))!==i)break}catch(r){o=e,c=1,u=r}finally{l=1}}return{value:r,done:s}}}(n,a,o),!0),l}var i={};function c(){}function u(){}function l(){}r=Object.getPrototypeOf;var f=[][t]?r(r([][t]())):(_regeneratorDefine2(r={},t,function(){return this}),r),s=l.prototype=c.prototype=Object.create(f);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(s),e}return u.prototype=l,_regeneratorDefine2(s,"constructor",l),_regeneratorDefine2(l,"constructor",u),u.displayName="GeneratorFunction",_regeneratorDefine2(l,a,"GeneratorFunction"),_regeneratorDefine2(s),_regeneratorDefine2(s,a,"Generator"),_regeneratorDefine2(s,t,function(){return this}),_regeneratorDefine2(s,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:d}})()}function _regeneratorDefine2(e,r,n,t){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function(e,r,n,t){function o(r,n){_regeneratorDefine2(e,r,function(e){return this._invoke(r,n,e)})}r?a?a(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,r,n,t)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw o}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=Array(r);n<r;n++)t[n]=e[n];return t}function asyncGeneratorStep(e,r,n,t,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?r(u):Promise.resolve(u).then(t,a)}function _asyncToGenerator(e){return function(){var r=this,n=arguments;return new Promise(function(t,a){var o=e.apply(r,n);function i(e){asyncGeneratorStep(o,t,a,i,c,"next",e)}function c(e){asyncGeneratorStep(o,t,a,i,c,"throw",e)}i(void 0)})}}import{structureBoxes}from"./StructureBoxes.js";import{drawElbowLines}from"./DrawLines.js";import{initializeDragging}from"./Draggable.js";var ORG_TABLE_NAME="OrgData";export function createTable(){return _createTable.apply(this,arguments)}function _createTable(){return _createTable=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(r){var n,t,a,o,i,c,u,l,f;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return n=r.workbook.worksheets.getActiveWorksheet(),(t=r.workbook.getActiveCell()).load("rowIndex, columnIndex"),e.n=1,r.sync();case 1:return a=t.rowIndex,o=t.columnIndex,n.tables.load("name"),e.n=2,r.sync();case 2:return n.tables.items.filter(function(e){return e.name===ORG_TABLE_NAME}).forEach(function(e){return e.delete()}),i=[{id:1,parent:null,name:"CEO Office",colour:"#2c3e50",lines:["Strategic Direction","Founder","#Top Level"]},{id:2,parent:1,name:"VP Technology",colour:"#34495e",lines:["IT & Engineering","#Management"]},{id:3,parent:1,name:"VP Operations",colour:"#34495e",lines:["Logistics & HR","#Management"]},{id:4,parent:2,name:"Head of Software",colour:"#2980b9",lines:["Development Dept","#Product","#Innovation"]},{id:5,parent:2,name:"Head of Infrastructure",colour:"#2980b9",lines:["Cloud & Networks","#Product"]},{id:6,parent:3,name:"Head of Logistics",colour:"#e67e22",lines:["Supply Chain","#Operations"]},{id:7,parent:4,name:"Backend Lead",colour:"#7f8c8d",lines:["API Team","#Product","#Technical"]},{id:8,parent:4,name:"Frontend Lead",colour:"#7f8c8d",lines:["UI Team","#Product","#Technical"]},{id:9,parent:6,name:"Warehouse Manager",colour:"#7f8c8d",lines:["Distribution","#Operations","#Logistics"]},{id:10,parent:7,name:"Senior Developer",colour:"#95a5a6",lines:["Backend Service","#Technical","#Remote"]},{id:11,parent:7,name:"Junior Developer",colour:"#95a5a6",lines:["Backend Service","#Technical","#Remote"]},{id:12,parent:8,name:"UI Designer",colour:"#95a5a6",lines:["Frontend Team","#Product","#Remote"]},{id:13,parent:9,name:"Logistics Coordinator",colour:"#95a5a6",lines:["Shipping","#Operations","#Office"]},{id:14,parent:9,name:"Driver",colour:"#95a5a6",lines:["Delivery","#Operations","#Field"]}],c=Math.max.apply(Math,_toConsumableArray(i.map(function(e){return e.lines.length}))),u=["id","parent","name","colour","image","custom header","custom header 2","!hidden header"],l=i.map(function(e){for(var r,n,t=e.lines.slice(0,c);t.length<c;)t.push("");return[e.id,null!==(r=e.parent)&&void 0!==r?r:"",e.name,e.colour,null!==(n=e.image)&&void 0!==n?n:""].concat(_toConsumableArray(t))}),(f=n.getRangeByIndexes(a,o,l.length+1,u.length)).values=[u].concat(_toConsumableArray(l)),n.tables.add(f,!0).name=ORG_TABLE_NAME,n.activate(),e.n=3,r.sync();case 3:return e.a(2)}},e)}));return function(r){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),_createTable.apply(this,arguments)}window.createTable=createTable;export function refresh(){return _refresh.apply(this,arguments)}function _refresh(){return(_refresh=_asyncToGenerator(_regenerator().m(function e(){var r,n,t,a;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return r=document.getElementById("org-container"),n=document.getElementById("ChartType").value,t=document.getElementById("LineType").value,r.innerHTML="",e.n=1,loadOrgDataFromExcel();case 1:if(validateHierarchy(a=e.v)){e.n=2;break}return console.error("Circular dependency detected in hierarchy!"),alert("Error: The organization chart contains a circular dependency (e.g., a person reporting to themselves or in a loop)."),e.a(2);case 2:r.appendChild(structureBoxes(a,n,t)),drawElbowLines(),initializeDragging();case 3:return e.a(2)}},e)}))).apply(this,arguments)}function loadOrgDataFromExcel(){return _loadOrgDataFromExcel.apply(this,arguments)}function _loadOrgDataFromExcel(){return _loadOrgDataFromExcel=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(r){var n,t,a,o,i;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=r.workbook.tables.getItem(ORG_TABLE_NAME),t=n.getHeaderRowRange(),a=n.getDataBodyRange(),t.load("values"),a.load("values"),e.n=1,r.sync();case 1:return o=t.values[0],i=["id","parent","name","colour","image"],e.a(2,a.values.map(function(e){var r=e.map(function(e,r){return{value:e,header:o[r]}}).filter(function(e){return!!e.value&&!e.header.startsWith("!")&&!i.includes(e.header)}).map(function(e){return e.value});return{id:e[o.indexOf("id")],parent:e[o.indexOf("parent")]||null,name:e[o.indexOf("name")],colour:e[o.indexOf("colour")],image:e[o.indexOf("image")]||null,lines:r}}));case 2:return e.p=2,e.v,alert('The required table "'.concat(ORG_TABLE_NAME,'" was not found. Please click "Create example table" first.')),e.a(2,[])}},e,null,[[0,2]])}));return function(r){return e.apply(this,arguments)}}()))},e)})),_loadOrgDataFromExcel.apply(this,arguments)}function validateHierarchy(e){var r=new Map;e.forEach(function(e){return r.set(e.id.toString(),e)});var n=new Set,t=new Set;function a(e){n.add(e),t.add(e);var o=r.get(e);if(o&&o.parent){var i=o.parent.toString();if(n.has(i)){if(t.has(i))return!0}else if(a(i))return!0}return t.delete(e),!1}var o,i=_createForOfIteratorHelper(e);try{for(i.s();!(o=i.n()).done;){var c=o.value;if(!n.has(c.id.toString())&&a(c.id.toString()))return!1}}catch(e){i.e(e)}finally{i.f()}return!0}window.refresh=refresh;